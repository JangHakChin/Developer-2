<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.developer.studyroom">

<!-- sr: reservationOpen Start -->
<update id="reservationOpen" parameterType = "String">
	UPDATE studyroom
	SET oc = 0
	WHERE sr_seq = (SELECT sr_seq FROM studyroom
               		WHERE host_id = #{hostId})
</update>
<!-- sr: reservationOpen End -->

<!-- sr: reservationClose start-->
<update id="reservationClose" parameterType = "String">
	UPDATE studyroom
	SET oc = 1
	WHERE sr_seq = (SELECT sr_seq FROM studyroom
               		WHERE host_id = #{hostId})

</update>
<!-- sr: reservationClose End-->

<!-- sr: getStudycafe start-->
<select id="getStudycafe" parameterType="String" resultType="StudyroomVO">
select * from studyroom where host_id = #{hostId} 
</select>
<!-- sr: getStudycafe end-->


<!-- sr: updateStudycafe start-->
<update id="updateStudycafe" parameterType = "StudyroomVO">
	UPDATE studyroom 
	set name=#{name}, info=#{info},img_path=#{imgPath}, open_time=#{openTime},end_time=#{endTime}
	where sr_seq=#{srSeq}

</update>
<!-- sr: updateStudycafe end-->

<!-- sr: insertStudycafe start-->
<insert id="insertStudycafe" parameterType = "StudyroomVO">

INSERT into studyroom(sr_seq, name, addr, info, open_time, end_time, img_path, oc, host_id) values
(sr_seq.nextval, #{name}, #{addr}, 
#{info}, #{openTime}, #{endTime}, #{imgPath}, 
#{oc}, #{hostId})
</insert>
<!-- sr: insertStudycafe End-->

<!-- sr: selectAllRoom start-->
<resultMap type="StudyroomVO" id="selectAllRoomMap" autoMapping = "true">
		<id column="sr_seq" property="srSeq" />
		
		<collection property="roomInfoVO" ofType="RoomInfoVO" autoMapping="true">
		<id column="room_seq" property="roomSeq" />
		<result column="name" property="name" />
		<result column="info" property="info" />
		<result column="img_path" property="imgPath" />
		<result column="person" property="person" />
		<result column="price" property="price" />
		
		</collection>
	</resultMap>

	<select id="selectAllRoom" parameterType ="String" resultMap="selectAllRoomMap">
	SELECT rif.room_seq, rif.name, rif.info, rif.img_path, rif.person, rif.price
	FROM studyroom s, room_info rif
	where s.sr_seq = rif.sr_seq
	And s.host_id  = #{hostId}
	ORDER BY rif.room_seq ASC
	</select>
<!-- sr: selectAllRoom End-->

<!-- sr: getHostAndStudyroom Start -->
	<resultMap type="StudyroomVO" id="getHostAndStudyroomMap" autoMapping = "true">
		<id column="sr_seq" property="srSeq" />
		
		<association property="hostUserVO" javaType = "HostUserVO" autoMapping = "true">
		<id column = "host_id" property="hostId" />
		</association>
	</resultMap>

	<select id="getHostAndStudyroom" resultMap="getHostAndStudyroomMap">
	SELECT * 
	FROM host_user h
	LEFT JOIN studyroom s
     	 ON h.host_id = s.host_id
	WHERE h.host_id = #{hostId}
	</select>
<!-- sr: getHostAndStudyroom End -->

</mapper>