<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.developer.reservation">


<resultMap type="ReservationVO" id="reservationMap">
	<id column="room_seq" property="roomSeq"/>
	<result column="start_time" property="startTime"/>
	<result column="end_time" property="endTime"/>
	<result column="using_date" property="usingDate"/>
 	
 	<association property="studyroomVO" javaType="StudyroomVO" autoMapping="true">
	 	<association property="roomInfoVO" javaType="RoomInfoVO" autoMapping="true">
	 		<result column="price" property="price"/>
	 	</association>
 	</association>
 </resultMap>


<select id="selectAllByUsingDate" resultMap="reservationMap">
 <![CDATA[
select r.room_seq, r.start_time, r.end_time, r.using_date, ro.price 
from reservation r, room_info ro, studyroom sr
where r.room_seq = ro.room_seq
AND r.room_seq=#{roomSeq}
AND r.using_date=#{usingDate}
AND sr.sr_seq = ro.sr_seq
AND to_date(r.start_time,'HH24:MI') >= to_date(sr.open_time,'HH24:MI')
AND to_date(r.end_time,'HH24:MI') <= to_date(sr.end_time,'HH24:MI')
]]>
</select>


<insert id="insertRv">
INSERT INTO reservation 
VALUES(res_seq.nextval, #{userId},
 #{roomSeq}, #{startTime}, #{endTime}, #{usingDate})
</insert>


<delete id="deleteRv" >
DELETE FROM reservation
WHERE res_seq = #{resSeq}
</delete>

</mapper>

